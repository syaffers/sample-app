<% provide :title, @paper.title %>
<div class="row show-paper">
    <h3 class="title"><%= @paper.title %></h3>
    <div class="span1">
        <div class="votes">
            <%= render "vote" %>
        </div>
    </div>
    <div class="span8 pdf-view">
        <iframe src="https://docs.google.com/viewer?url=http://localhost:3000<%= @paper.pdf.url %>&embedded=true" width="100%" height="450" frameborder="0">
            <p>Your browser does not support iframes.</p>
        </iframe>
    </div>
    <div class="span3 paper-head">
        <p class="submitted-by">
            <strong>Submitted by:</strong>
            <%= link_to @paper.user.name, @paper.user %>
        </p>
        <p class="submitted-in">
            <strong>Submitted in:</strong>
            <%= @paper.subject.name %>
        </p>
        <p class="version">
            <strong>Version:</strong>
            <%= @paper.version %>
                <em>
                    <% if @paper.updated_at == @paper.created_at %>
                        (created
                    <% else %>
                        (updated
                    <% end %>
                    <%= time_ago_in_words(@paper.updated_at) %> ago)
                </em>
                <%= link_to "Download", @paper.pdf.url %>
            <% if !current_user.nil? %>
                <% if @paper.user == current_user %>
                    |
                    <%= link_to 'Update Paper', edit_paper_path(@paper) %>
                <% end %>
            <% end %>
        </p>
        <p class="older-versions">
            <strong>
                Older versions:
            </strong>
            <% if @paper.version > 1 %>
                <% (@paper.version - 1).times do |n| %>
                    <%= link_to n+1, @paper.pdf.url.sub!("v#{@paper.version}", "v#{n+1}") %>
                <%end%>
            <% end %>
        </p>
        <p class="status">
            <strong>Status:</strong>
            <% if @paper.published? %>
                Paper published
            <% else %>
                Paper under reviewing process
                <% if accepted_reviews_for(@paper) >= 3 && paper_user?(@paper)%>
                    <%= link_to "Publish this paper", publish_paper_path(@paper), class: "publish", method: :put %>
                <% end %>
            <% end %>
        </p>
        <p>
            <strong>Tags:</strong>
            <%= @paper.tag_list %>
        </p>
        
        <p>
            <strong>Supporting Files:</strong>
        </p>
        <ul class="supporting-files">
            <% @paper.assets.each do |asset|%>
                <li>
                    <p><%= link_to asset.asset_file_name, asset.asset.url %></p>
                </li>
            <% end %>
        </ul>        
        <hr />
        
        <h4>Similar Papers</h4>
        <ul class="matching-papers">
            <% @matching_papers[0..3].each do |paper|%>
                <li>
                    <p>
                        <%= link_to paper.title, paper %>
                        by
                        <%= link_to paper.user.name, paper.user %>
                    </p>
                </li>
            <% end %>
        </ul>
    </div>
    <div class="span12 reviews">
        <%= render "reviews/review" %>
    </div>
    <div class="span12 comments">
        <%= render "comments/comment" %>
        <%= render "comments/form" %>
    </div>
</div>
